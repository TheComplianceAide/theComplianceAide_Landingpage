(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[101,3116,9605],{17971:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});let r={src:"/_next/static/media/clouds1.9209e211.png",height:639,width:1186,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAECAMAAACEE47CAAAAM1BMVEVUapzq4d7/7+D/+ej67uz57+T///4xSbC3qM3Xz9rXv9Pr2dlRcsS/uNO/sdeNks1Kbrk1jFqpAAAAEXRSTlMBb0Mu/XkHFBbOyY9OwPTcnUujwrYAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAoSURBVHicY2BgYGBm5eZgYGBjYmVhYeHjYWDk5OTl5OIXYOBgZwdjAAyJAM3kJxnzAAAAAElFTkSuQmCC",blurWidth:8,blurHeight:4}},72216:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});let r={src:"/_next/static/media/clouds2.b6ae5b45.png",height:639,width:1221,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAECAMAAACEE47CAAAAM1BMVEVMaXHt5N7/8N09Zrza0dusrNb26uk1XMiin8Xz59/YwNb//+a1qNPDu9RFbLmGj83/8u7+n/uqAAAAEHRSTlMAVzYyyhX6EgRtxR/dwoHeF7J08gAAAAlwSFlzAAALEwAACxMBAJqcGAAAAChJREFUeJwFwYkBACAIxLCq4IH//tOaQGROgLZe71mDc4dts0JIjuQfDu4A0ztn0lYAAAAASUVORK5CYII=",blurWidth:8,blurHeight:4}},41661:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{default:function(){return i},noSSR:function(){return a}});let r=n(36004);n(31085),n(14041);let s=r._(n(3938));function o(e){return{default:(null==e?void 0:e.default)||e}}function a(e,t){return delete t.webpack,delete t.modules,e(t)}function i(e,t){let n=s.default,r={loading:e=>{let{error:t,isLoading:n,pastDelay:r}=e;return null}};e instanceof Promise?r.loader=()=>e:"function"==typeof e?r.loader=e:"object"==typeof e&&(r={...r,...e});let i=(r={...r,...t}).loader;return(r.loadableGenerated&&(r={...r,...r.loadableGenerated},delete r.loadableGenerated),"boolean"!=typeof r.ssr||r.ssr)?n({...r,loader:()=>null!=i?i().then(o):Promise.resolve(o(()=>null))}):(delete r.webpack,delete r.modules,a(n,r))}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},54180:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"LoadableContext",{enumerable:!0,get:function(){return r}});let r=n(36004)._(n(14041)).default.createContext(null)},3938:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return h}});let r=n(36004)._(n(14041)),s=n(54180),o=[],a=[],i=!1;function l(e){let t=e(),n={loading:!0,loaded:null,error:null};return n.promise=t.then(e=>(n.loading=!1,n.loaded=e,e)).catch(e=>{throw n.loading=!1,n.error=e,e}),n}class d{promise(){return this._res.promise}retry(){this._clearTimeouts(),this._res=this._loadFn(this._opts.loader),this._state={pastDelay:!1,timedOut:!1};let{_res:e,_opts:t}=this;e.loading&&("number"==typeof t.delay&&(0===t.delay?this._state.pastDelay=!0:this._delay=setTimeout(()=>{this._update({pastDelay:!0})},t.delay)),"number"==typeof t.timeout&&(this._timeout=setTimeout(()=>{this._update({timedOut:!0})},t.timeout))),this._res.promise.then(()=>{this._update({}),this._clearTimeouts()}).catch(e=>{this._update({}),this._clearTimeouts()}),this._update({})}_update(e){this._state={...this._state,error:this._res.error,loaded:this._res.loaded,loading:this._res.loading,...e},this._callbacks.forEach(e=>e())}_clearTimeouts(){clearTimeout(this._delay),clearTimeout(this._timeout)}getCurrentValue(){return this._state}subscribe(e){return this._callbacks.add(e),()=>{this._callbacks.delete(e)}}constructor(e,t){this._loadFn=e,this._opts=t,this._callbacks=new Set,this._delay=null,this._timeout=null,this.retry()}}function c(e){return function(e,t){let n=Object.assign({loader:null,loading:null,delay:200,timeout:null,webpack:null,modules:null},t),o=null;function l(){if(!o){let t=new d(e,n);o={getCurrentValue:t.getCurrentValue.bind(t),subscribe:t.subscribe.bind(t),retry:t.retry.bind(t),promise:t.promise.bind(t)}}return o.promise()}if(!i){let e=n.webpack?n.webpack():n.modules;e&&a.push(t=>{for(let n of e)if(t.includes(n))return l()})}function c(e,t){!function(){l();let e=r.default.useContext(s.LoadableContext);e&&Array.isArray(n.modules)&&n.modules.forEach(t=>{e(t)})}();let a=r.default.useSyncExternalStore(o.subscribe,o.getCurrentValue,o.getCurrentValue);return r.default.useImperativeHandle(t,()=>({retry:o.retry}),[]),r.default.useMemo(()=>{var t;return a.loading||a.error?r.default.createElement(n.loading,{isLoading:a.loading,pastDelay:a.pastDelay,timedOut:a.timedOut,error:a.error,retry:o.retry}):a.loaded?r.default.createElement((t=a.loaded)&&t.default?t.default:t,e):null},[e,a])}return c.preload=()=>l(),c.displayName="LoadableComponent",r.default.forwardRef(c)}(l,e)}function u(e,t){let n=[];for(;e.length;){let r=e.pop();n.push(r(t))}return Promise.all(n).then(()=>{if(e.length)return u(e,t)})}c.preloadAll=()=>new Promise((e,t)=>{u(o).then(e,t)}),c.preloadReady=e=>(void 0===e&&(e=[]),new Promise(t=>{let n=()=>(i=!0,t());u(a,e).then(n,n)})),window.__NEXT_PRELOADREADY=c.preloadReady;let h=c},8136:(e,t,n)=>{"use strict";let r;n.d(t,{h:()=>eO});var s=n(31085);n(6540);var o=n(6172),a=n(3564),i=n(12327),l=n(2657),d=n.n(l),c=n(31242),u=n(14041),h=n(32133),p=n(73893),f=n(56154),m=n(50877),g=n(88744);let w=e=>{let t=["malformed","encoded","illegal"];return e.includes("URIError")&&e.split(" ").some(e=>t.includes(e))};class y extends u.Component{componentDidMount(){window.addEventListener("error",this.handleError),window.addEventListener("unhandledrejection",this.handleUnhandledRejection)}componentWillUnmount(){window.removeEventListener("error",this.handleError),window.removeEventListener("unhandledrejection",this.handleUnhandledRejection)}componentDidCatch(e,t){if("dev"===p.$.APPLICATION_ENVIRONMENT)throw e;f.Cp(e,{extra:{info:null==t?void 0:t.componentStack}})}static getDerivedStateFromError(e){return{hasError:!0,errMessage:e.message,shouldMountChildren:!1}}handleError(e){if("dev"===p.$.APPLICATION_ENVIRONMENT)throw Error("[ErrorBoundary]: ".concat(e.message))}handleUnhandledRejection(e){if(this.props.unhandledRejectionFilter(e)){var t;let n=(null===(t=e.reason)||void 0===t?void 0:t.message)||"";this.setState({hasError:!0,errMessage:n})}}render(){let e=!0===w(this.state.errMessage)?{opacity:"0.65",starOverlay:!1}:{};return(0,s.jsxs)(s.Fragment,{children:[this.state.hasError&&(0,s.jsx)(g.A,{pos:"absolute",top:0,...e,errMessage:""===this.state.errMessage?void 0:this.state.errMessage,showDisclosure:!0}),this.state.shouldMountChildren&&this.props.children]})}constructor(e){super(e),this.state={hasError:!1,errMessage:"",shouldMountChildren:!0},this.handleError=this.handleError.bind(this),this.handleUnhandledRejection=this.handleUnhandledRejection.bind(this)}}y.defaultProps={unhandledRejectionFilter:e=>{var t;return!!w((null===(t=e.reason)||void 0===t?void 0:t.message)||"")||e.reason instanceof m.Teu&&!1===document.hidden||e.reason instanceof m.cdx}};var A=n(85401),v=n(60916),b=n(88304),M=n(42457),S=n(14525),C=n(22082),k=n(31757),x=n(64225);let E=e=>{console.debug("%c[useApiRefetch] Refetching due to ".concat(e),"background-color: aqua"),(0,S.H4)().reFetchObservableQueries()},j=()=>{let e=(0,x.CU)(),t=(0,u.useRef)(!1),n=(0,u.useRef)(null),r=(0,u.useCallback)(e=>{n.current&&(clearTimeout(n.current),n.current=null),n.current=setTimeout(()=>{E(e),n.current=null},3e3)},[]),s=(0,u.useCallback)(()=>(0,k.mN)(e.getState()).backgrounded,[e]);(0,C.LQ)("online",(0,u.useCallback)(()=>{if(s()){t.current=!0;return}r("online")},[r,s])),(0,C.LQ)("wakeup",(0,u.useCallback)(()=>{if(s()){t.current=!0;return}r("wakeup")},[r,s])),(0,C.LQ)("foreground",(0,u.useCallback)(()=>{t.current&&(r("foreground"),t.current=!1)},[r]))},D=Number(new URLSearchParams(p.$.IS_CLIENT_SIDE?window.location.search:"").get("MAX_BACKGROUND_TIME_ALLOWED"))||432e5,I=()=>{let e=(0,u.useRef)(!1),t=(0,u.useCallback)(t=>{t.timeInBackground&&!e.current&&t.timeInBackground>D&&(e.current=!0,window.location.reload())},[]);(0,C.LQ)("foreground",t)},_=(0,u.memo)(()=>((0,C.yj)(),j(),I(),null));_.displayName="ConnectionMonitor";var P=n(86507),O=n(52609),T=n(35002),R=n(58167),N=n(10458),Y=n(57882);let B=(e,t)=>{R.H.init(p.$.HIGHLIGHT_PROJECT_ID,{environment:p.$.APPLICATION_ENVIRONMENT,sessionShortcut:!!t&&"shift+command+0",enableStrictPrivacy:e,enableSegmentIntegration:!0,networkRecording:{enabled:!0,recordHeadersAndBody:!0}}),N.zS.loadSdkPromise.then(e=>{e&&e.addSourceMiddleware(R.aS)})},z=e=>{let{children:t}=e,{user:n,anonymousUser:r,isGammaOrgUser:o,isUserLoading:a}=(0,Y.ur)(),{enabled:i,enableStrictPrivacy:l}=(0,T.u)("highlight");return(0,u.useEffect)(()=>{i&&!a&&n&&B(l,o)},[l,i,o,a,n]),(0,u.useEffect)(()=>{if(!a){if(n){let{id:e,displayName:t,email:r,profileImageUrl:s}=n;R.H.identify(e,{highlightDisplayName:t,email:r,avatar:s})}else if(null==r?void 0:r.id){let{id:e,displayName:t}=r;R.H.identify("",{anonDisplayName:t||"",anonId:e})}}},[n,r,a]),(0,s.jsx)(s.Fragment,{children:t})};var L=n(83479),F=n(95640),q=n(1892),U=n(32222),H=n(98692);let K=e=>{let{children:t}=e;return(0,U.Z)(),(0,q.e)(),(0,H.Z)(),(0,s.jsx)(F.CY,{i18n:i.Ru,children:t})};var V=n(20879),G=n(6657),$=n(63044),Q=n(57999),J=n(51462),W=n(60285),Z=n(69011),X=n.n(Z),ee=n(5720);class et{async enable(){try{await window.serwist.register()}catch(e){console.error("Error registering Serwist service worker:",e)}}async disable(){try{for(let e of(await navigator.serviceWorker.getRegistrations()))console.debug("offlineMode - [SerwistOfflineCache] Unregistering service worker:",e),await e.unregister()}catch(e){console.error("Error unregistering Serwist service worker:",e)}try{await this.clearCaches()}catch(e){console.error("Error clearing caches",e)}this.store.dispatch((0,ee.Em)())}async debug(){let e=await window.caches.keys();return{cache:(await Promise.all(e.map(async e=>{let t=await window.caches.open(e).then(e=>e.matchAll());return[e,t]}))).reduce((e,t)=>(e[t[0]]=t[1],e),{})}}async gc(e){}async clearCaches(){try{if(!window.caches)return;for(let e of(await window.caches.keys()))await window.caches.delete(e);console.debug("offlineMode - [SerwistOfflineCache] Serwist caches cleared successfully")}catch(e){console.error("Error clearing caches",e)}}constructor(){this.store=(0,x.KA)()}}let en=X()(()=>new et);var er=n(40269),es=n(26488),eo=n(12784),ea=n.n(eo),ei=n(46343),el=n.n(ei);let ed="offline-state-v1",ec=e=>{let t=eu(),n=null;t&&(console.debug("offlineMode - [setupOfflineManagerPersistence] LOADING PERSISTED STATE",t),e.dispatch((0,ee.OA)(t)),n=t);let r=ea()(e=>{eh(e)},500);return e.subscribe(()=>{let t=(0,ee.uc)(e.getState());if(n!==t){if(el()(n,t)){n=t;return}n=t,console.debug("offlineMode - [setupOfflineManagerPersistence] PERSISTING STATE",t),r(t)}})},eu=()=>{try{let e=localStorage.getItem(ed);return JSON.parse(e)}catch(e){return null}},eh=async e=>{try{let t=JSON.stringify(e);localStorage.setItem(ed,t)}catch(e){console.error("Error persisting state",e)}},ep=(0,es.B)();class ef{get enabled(){return(0,ee.yy)(this.store.getState())}async init(){if(!ep){console.debug("offlineMode - [OfflineManager] Offline mode is not supported");return}this.cleanupFns.push(ec(this.store)),await this.notifyCaches(this.enabled),console.debug("offlineMode - [OfflineManager] caches initialized",this.enabled),this.setupFeatureFlagSubscription(),this.setupConnectionListener(),console.debug("offlineMode - [OfflineManager] subscriptions initialized")}setupConnectionListener(){let e=Q.l.on("offline",()=>{this.apolloOfflineCache.useOfflineCache()}),t=Q.l.on("online",()=>{this.apolloOfflineCache.backOnline()});this.cleanupFns.push(t),this.cleanupFns.push(e)}setupFeatureFlagSubscription(){T.of.initializePromise.then(()=>{let e=T.of.get("offline");e!==this.enabled&&(e?this.enable():this.disable()),this.cleanupFns.push(T.of.subscribe("offline",e=>{e?this.enable():this.disable()}))})}async enable(){if(!ep){console.debug("offlineMode - [OfflineManager] Offline mode is not supported");return}if(this.enabled){console.warn("Offline mode already enabled");return}let{user:e,status:t}=await (0,J.m)({returnOfflineUser:!1});if("loggedIn"!==t){console.warn("[OfflineManager] Offline mode user not logged in");return}await this.notifyCaches(!0),this.store.dispatch((0,ee.Es)({user:e,lastSynced:new Date().toISOString()}))}async disable(){if(!ep){console.debug("offlineMode - [OfflineManager] Offline mode is not supported");return}if(!this.enabled){console.warn("[OfflineManager] Offline mode already disabled");return}await this.notifyCaches(!1),this.store.dispatch((0,ee.lK)())}async notifyCaches(e){return Promise.all(e?this.caches.map(e=>e.enable()):this.caches.map(e=>e.disable()))}cleanup(){for(;this.cleanupFns.length>0;){var e;null===(e=this.cleanupFns.pop())||void 0===e||e()}}constructor(){this.store=(0,x.KA)(),this.serwistOfflineCache=en(),this.ydocOfflineCache=(0,er.f)(),this.apolloOfflineCache=(0,W.h)(),this.caches=[this.serwistOfflineCache,this.ydocOfflineCache,this.apolloOfflineCache],this.cleanupFns=[]}}let em=async()=>{if(r)throw Error("OfflineManager already initialized");try{r=new ef,await r.init()}catch(e){console.error("Error initializing OfflineManager",e)}};window.getOfflineManagerState=()=>(0,x.KA)().getState().OfflineManager,window.getOfflineManager=()=>r;var eg=n(63899),ew=n(59025),ey=n(69087);let eA="no_org_id",ev=e=>{let{children:t}=e;(0,ew.Iy)();let{user:n,anonymousUser:r,currentWorkspace:o,isUserLoading:a}=(0,Y.ur)();return(0,u.useEffect)(()=>{let e=(0,ey.g)();(0,eg.eZ)(e.get()),e.fetch().then(eg.eZ).catch(()=>{})},[]),(0,u.useEffect)(()=>{let e;if(!a){if(n){let{id:t,email:r}=n,s=!!r&&r.endsWith("@gamma.app");e={userId:t,isGammaUser:s,userOrgId:(null==o?void 0:o.id)||eA,anonymousUser:!1,gammaUserFirstName:s?n.firstName:""}}else e={userId:"anonymous_user",isGammaUser:!1,userOrgId:eA,anonymousUser:!0,gammaUserFirstName:""};(0,eg.eZ)(e)}},[a,n,r,o]),(0,s.jsx)(s.Fragment,{children:t})};var eb=n(19408),eM=n(50923),eS=n(13154),eC=n(35015),ek=n(39236),ex=n(44507),eE=n(98371),ej=n(15576),eD=n(30503);n(68647),n(37272),n(41378),n(23472),n(98701),n(11291),n(52984),n(68765),n(57769),a.$W.autoAddCss=!1;let eI=(0,x.KA)();em();let e_=(0,m.fqS)({supportOfflineMode:!0}),eP=(0,m.fFM)();(0,eE.xy)(),G.WC.initialize(),(0,L.Wf)(),N.zS.init(),(0,P.Lm)(),(0,P.Gu)(),(0,V.Ts)(),(0,O.li)(),(0,eS.P)("appMainBundleLoaded"),T.of.get("debugLogging")||(window.console.debug=()=>{});let eO=e=>function(t){return(0,s.jsx)(eT,{children:(0,s.jsx)(e,{...t})})},eT=e=>{let{children:t}=e,n=(0,c.useRouter)();(0,eb.R)(),(0,ej.E)(),(0,A.G)(),(0,u.useEffect)(()=>{let e=(e,t)=>{let{shallow:n}=t;console.debug("[GammaApp - handleRouteChange] App is changing to ".concat(e," ").concat(n?"with":"without"," shallow routing"))};return n.events.on("routeChangeStart",e),()=>{n.events.off("routeChangeStart",e)}},[n]);let r=(0,eC.dC)();return(0,s.jsx)(h.Kq,{store:eI,children:(0,s.jsx)(K,{children:(0,s.jsx)(M.Z,{children:(0,s.jsx)(y,{children:(0,s.jsx)(o.X,{client:e_,children:(0,s.jsxs)(m.N0f,{client:eP,children:[(0,s.jsx)(eR,{}),(0,s.jsx)(v.fH,{}),(0,s.jsx)(V.FM,{}),(0,s.jsx)(ek.I,{}),(0,s.jsx)(b.D,{}),(0,s.jsx)(_,{}),(0,s.jsxs)(Y.ac,{children:[(0,s.jsx)(eM.M7,{children:(0,s.jsx)(T.Yy,{children:(0,s.jsx)($.K,{children:(0,s.jsx)(ev,{children:(0,s.jsx)(z,{children:(0,s.jsx)(eC.gk,{value:r,children:t})})})})})}),(0,s.jsx)(T.zf,{})]})]})})})})})})},eR=()=>{let e=p.$.OG_IMAGE_URL_REBRAND,t=i.Ru._({id:"0v7kQB"}),n=p.$.APPLICATION_ENVIRONMENT;return(0,s.jsxs)(d(),{children:[(0,s.jsx)("title",{children:"Gamma"}),"production"!==n&&(0,s.jsx)("meta",{name:"robots",content:"noindex, nofollow"}),(0,s.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0, viewport-fit=cover"}),(0,s.jsx)("link",{rel:"manifest",href:"/manifest.json"}),"production"!==n?(0,s.jsx)("link",{rel:"shortcut icon",href:"staging"===n?"/icons/favicon_staging.jpg":"/icons/favicon_local.jpg"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("link",{rel:"icon",type:"image/svg+xml",href:"https://static.gamma.app/favicons/favicon_light.svg",media:"(prefers-color-scheme: light)"}),(0,s.jsx)("link",{rel:"icon",type:"image/svg+xml",href:"https://static.gamma.app/favicons/favicon_dark.svg",media:"(prefers-color-scheme: dark)"})]}),(0,s.jsx)("meta",{content:t,name:"description"},"description"),(0,s.jsx)("meta",{content:"Gamma",property:"og:title"},"og:title"),(0,s.jsx)("meta",{content:t,property:"og:description"},"og:description"),(0,s.jsx)("meta",{content:e,property:"og:image"},"og:image"),(0,s.jsx)("meta",{content:"Gamma",property:"twitter:title"},"twitter:title"),(0,s.jsx)("meta",{content:t,property:"twitter:description"},"twitter:description"),(0,s.jsx)("meta",{content:e,property:"twitter:image"},"twitter:image"),(0,s.jsx)("meta",{property:"og:type",content:"website"},"og:type"),(0,s.jsx)("meta",{content:"summary_large_image",name:"twitter:card"},"twitter:card"),(0,s.jsx)("meta",{name:"google",content:"notranslate"}),(0,s.jsx)("link",{href:"https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900",rel:"stylesheet"}),(0,s.jsx)("link",{rel:"stylesheet",href:"https://use.typekit.net/tiw2cwq.css"}),!(0,ex.rA)()&&!(0,eD.NF)()&&(0,s.jsx)("script",{async:!0,src:"https://cdn.optimizely.com/js/20579410255.js"}),(0,s.jsx)("script",{src:"//cdn.iframe.ly/embed.js",async:!0,charSet:"utf-8"})]})}},28947:(e,t,n)=>{"use strict";n.d(t,{Kp:()=>v,hj:()=>y});var r=n(31085),s=n(25420),o=n(35687),a=n(3706),i=n(61778),l=n(2219),d=n(80532),c=n(15428),u=n(9104);n(14041);var h=n(47798),p=n(83073),f=n(28583),m=n(17971),g=n(72216),w=n(90088);let y=e=>{let{children:t,pageProps:n}=e;return(0,r.jsxs)(s.s,{h:"100%",w:"100vw",overflow:"hidden",display:"flex",justify:"center",align:"center",position:"relative",bg:"linear-gradient(to top, #FFF,rgb(198, 230, 250))",...n,children:[(0,r.jsx)(c.mL,{styles:{"html, body":{height:"100%"}}}),(0,r.jsx)(s.s,{flex:1,w:"100%",h:"100%",overflow:"auto",align:"center",justify:"center","data-centered-message-card-wrapper":!0,children:t}),(0,r.jsx)(s.s,{display:{base:"none",lg:"block"},position:"absolute",w:"35vw",maxW:"500px",h:"30vh",background:"url(".concat(g.A.src,")"),backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"bottom",bottom:"30%",insetEnd:"0%",opacity:.5,transform:"translateX(-20%)"}),(0,r.jsx)(s.s,{display:{base:"none",lg:"block"},position:"absolute",w:"35vw",maxW:"500px",h:"30vh",background:"url(".concat(m.A.src,")"),backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"bottom",bottom:"30%",insetStart:"0%",opacity:.5,transform:"translateX(20%)"})]})},A=()=>{let e=(0,p.O)();return(0,r.jsxs)(o.B,{direction:"row",justify:"space-between",alignItems:"center",children:[(0,r.jsx)(a.N,{href:(0,f.gt)(e).home,isExternal:!0,children:(0,r.jsx)(u.Fu,{w:"100px"})}),(0,r.jsx)(h.V,{buttonProps:{variant:"ghost",colorScheme:"blackAlpha",color:"gray.800"}})]})},v=e=>{let{lede:t,title:n,children:s,stackProps:a,showFooter:c=!1}=e;return(0,r.jsxs)(o.B,{bg:"white",padding:{base:6,md:8},zIndex:"2",borderRadius:{base:"none",md:"xl"},shadow:{base:"none",md:"lg"},maxW:"100%",w:{base:"100%",md:"500px"},spacing:8,m:{base:0,md:8},minH:{base:"100%",md:"auto"},...a,children:[(0,r.jsx)(A,{}),t&&("string"==typeof t?(0,r.jsx)(i.E,{fontSize:"sm",color:"gray.500",children:t}):t),n&&(0,r.jsx)(l.D,{variant:"fancy",fontWeight:500,fontSize:["3xl"],children:n}),(0,r.jsx)(d.az,{flex:1,children:s}),c&&(0,r.jsx)(b,{})]})},b=()=>(0,r.jsx)(o.B,{mt:12,align:"center",children:(0,r.jsxs)(i.E,{color:"gray.300",fontSize:"xs",sx:{a:{color:"gray.400",_hover:{textDecoration:"underline"}}},children:[(0,r.jsx)(a.N,{href:w.er,children:"Terms of Service"})," â€¢"," ",(0,r.jsx)(a.N,{href:w.WO,children:"Privacy Policy"})]})})},88744:(e,t,n)=>{"use strict";n.d(t,{A:()=>A});var r=n(31085),s=n(60353),o=n(14892),a=n(84755),i=n(80532),l=n(37586),d=n(58821),c=n(6256),u=n(80853),h=n(20501),p=n(24221),f=n(95640),m=n(28947),g=n(10891),w=n(15441);let y=(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(f.x6,{id:"nwtY4N"})," ",(0,r.jsx)("span",{role:"img","aria-label":"sad face",children:"\uD83D\uDE15"})]}),A=e=>{let{errMessage:t=y,showDisclosure:n=!1}=e;return(0,r.jsx)(w.L,{"data-error-component":!0,children:(0,r.jsx)(m.Kp,{stackProps:{textAlign:"center"},children:(0,r.jsxs)(g.K,{title:(0,r.jsx)(f.x6,{id:"yCLOsA"}),message:(0,r.jsx)(f.x6,{id:"oDmq3g"}),children:[n&&(0,r.jsx)(s.n,{allowToggle:!0,w:"100%",children:(0,r.jsxs)(o.A,{children:[(0,r.jsx)("h2",{children:(0,r.jsxs)(a.J,{children:[(0,r.jsx)(i.az,{flex:"1",textAlign:"start",children:(0,r.jsx)(f.x6,{id:"K6HS5B"})}),(0,r.jsx)(l.Q,{})]})}),(0,r.jsx)(d.v,{overflowX:"auto",children:(0,r.jsx)(c.C,{colorScheme:"red",maxHeight:{base:24,md:60},overflowY:"auto",children:t})})]})}),(0,r.jsx)(u.$,{mt:"4",leftIcon:(0,r.jsx)(p.g,{fixedWidth:!0,icon:h.lLb}),variant:"solid",onClick:()=>{window.location.reload()},children:(0,r.jsx)(f.x6,{id:"C6f2hU"})})]})})})}},10891:(e,t,n)=>{"use strict";n.d(t,{K:()=>c});var r=n(31085),s=n(35687),o=n(18651),a=n(2219),i=n(61778),l=n(12327);let d={src:"/_next/static/media/error-cat.e78a3685.png"},c=e=>{let{title:t,message:n,children:c,stackProps:u}=e;return(0,r.jsxs)(s.B,{spacing:4,alignItems:"center",textAlign:"center",...u,children:[(0,r.jsx)(o._,{src:d.src,w:{base:40,sm:60},alt:l.Ru._({id:"bHdr/A"})}),(0,r.jsx)(a.D,{variant:"fancy",fontSize:{base:"2xl",sm:"3xl"},css:{textWrap:"balance"},children:t}),n&&(0,r.jsx)(i.E,{css:{textWrap:"balance"},children:n}),c]})}},15441:(e,t,n)=>{"use strict";n.d(t,{L:()=>i});var r=n(31085),s=n(25420),o=n(15428),a=n(9104);let i=e=>{let{children:t,...n}=e;return(0,r.jsxs)(s.s,{w:"100%",h:"100%",overflow:"hidden",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",bg:"gradient.secondary-dark",...n,children:[(0,r.jsx)(a.lD,{height:"100%",sx:{maxHeight:"100vh",pointerEvents:"none"}}),(0,r.jsx)(o.mL,{styles:{"html, body":{height:"100%"}}}),t]})}},90088:(e,t,n)=>{"use strict";n.d(t,{Uf:()=>o,WO:()=>r,Yd:()=>a,er:()=>s});let r="https://gamma.app/privacy",s="https://gamma.app/terms",o="https://static.gamma.app/images/gamma-logo-deepocean-logomark-687b07e8.png",a="https://static.gamma.app/images/gamma-logo-deepocean-entri-5a938ad5.png"},60916:(e,t,n)=>{"use strict";n.d(t,{fH:()=>u,hw:()=>p,vj:()=>h});var r=n(31085),s=n(31242),o=n(66996),a=n.n(o),i=n(73893),l=n(92667),d=n(92947);let c=["/signin","/signup","/invitations/workspaces/[workspaceId]"],u=()=>{let e=(0,s.useRouter)().pathname;return!(0,l.En)()||c.includes(e)?null:(0,r.jsx)("style",{children:".grecaptcha-badge { visibility: hidden; }"})},h=()=>(0,r.jsx)(a(),{src:"https://www.google.com/recaptcha/enterprise.js?render=".concat(i.$.RECAPTCHA_SCORING_KEY),async:!0,defer:!0}),p=async e=>(await (0,d.f)(50,100)(()=>!!window.grecaptcha).catch(()=>{throw Error("Timed out waiting for grecaptcha")}),new Promise((t,n)=>{grecaptcha.enterprise.ready(async()=>{try{let n=await grecaptcha.enterprise.execute(i.$.RECAPTCHA_SCORING_KEY,{action:e});t(n)}catch(e){console.log(e),n(e)}})}))},9376:(e,t,n)=>{"use strict";n.d(t,{r:()=>u});var r=n(13236),s=n(14452),o=n(63587),a=n(76546),i=n(19534),l=n(4185),d=n(24643),c=n(21651);class u{static findCardById(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.findTopLevelCards(e).find(e=>e.cardId===t);if(!r)throw Error("Cannot find card with id ".concat(t));return n&&this.focusCard(e,r.pos),r}static async replaceCardById(e,t,n,r){let o=(0,s.DB)(r),i=await (0,l.Y)(o,{imageOptions:(0,c.I)(t,e),cardId:n}),h=u.findCardById(e,n),p=h.pos,f={from:p,to:p+e.state.doc.nodeAt(h.pos).nodeSize};e.chain().setMeta("cardNotesHandled",!0).insertContentAt(f,i).selectInsideCardBody(p).run();let m=(0,d.u0)(t.getState());return(0,a.de)(e,e.state.doc,m),{newHtml:o,replaceRange:f}}static getCurrentFocusedCard(e,t){let n=(0,d.lh)(t.getState());if(!n||"card"!==n.type)throw Error("Cannot find currently focused card");let r=n.cardId,s=this.findCardById(e,n.cardId);if(!s)throw Error("Cannot find card with id ".concat(r));let a=e.state.doc.nodeAt(s.pos),i=(0,o.K)(e,a);return{cardId:r,cardNum:s.cardNum,html:i}}static focusCard(e,t){e.commands.selectInsideCardBody(t)}static findTopLevelCards(e){return(0,r.xe)(e.state.doc,e=>(0,i.jg)(e)).filter(t=>1===e.state.doc.resolve(t.pos).depth).map((t,n)=>({pos:t.pos,node:t.node,cardNum:n+1,cardId:t.node.attrs.id,cardHtml:(0,o.K)(e,t.node)}))}static findCardNum(e,t){let n=this.findTopLevelCards(e).find(e=>e.cardId===t);if(!n)throw Error("Cannot find card with id ".concat(t));return n.cardNum}static findCreateCardInsertRange(e,t){let n=this.findTopLevelCards(e),r=t-1,s=n[r];if(r===n.length){let t=e.state.doc.nodeAt(n[r-1].pos),s=n[r-1].pos+t.nodeSize;return{from:s,to:s}}if(!s)throw Error("Cannot find card with index ".concat(r));return{from:s.pos,to:s.pos}}}},21651:(e,t,n)=>{"use strict";n.d(t,{I:()=>o});var r=n(43125),s=n(5933);let o=(e,t)=>{var n;let o=e.getState(),a=(null===(n=(0,r.lI)(t).aiOptions)||void 0===n?void 0:n.imageOptions)||{},i=(0,s.SJ)(o),l=a.license||"All",d=a.provider||"aiGenerated";return{license:l,provider:d,generateStyle:a.generateStyle||i.config.stylePrompt||"",model:a.model||"flux-1-schnell"}}},4185:(e,t,n)=>{"use strict";n.d(t,{Y:()=>d});var r=n(13236),s=n(21450),o=n(33587),a=n(57267),i=n(65208);let l=e=>"card"===e.type,d=async(e,t)=>{let n=await c(e,t);if(Array.isArray(n)&&(n=n[0]),!l(n))throw Error("Expected content to be a card");return n.attrs.id=t.cardId,n},c=async(e,t)=>{let n=t.imageOptions||{},l=await (0,o.eY)(e,{imageOptions:n,loadImages:!0}),d=(0,r._w)((0,a.C)()),{content:c}=(0,i.S)(l,d),u=c.toJSON();for(let e of u)n&&"aiGenerated"===n.provider&&(0,s.gZ)(e,d),"card"===e.type&&(0,s.wJ)(e);return u}},47798:(e,t,n)=>{"use strict";n.d(t,{V:()=>d});var r=n(31085),s=n(14041),o=n(59967),a=n(83073),i=n(67359),l=n(510);let d=e=>{let{buttonProps:t,showLabelOnMobile:n=!1}=e,d=(0,a.O)(),c=(0,s.useMemo)(()=>d,[]),[u,h]=(0,s.useState)(c);(0,i.O)(u);let p=(0,s.useCallback)(e=>{h(e),(0,l.Y)(e)},[]);return(0,r.jsx)(o.r,{selectedLocaleKey:d,onLocaleSelect:p,buttonProps:t,showLabelOnMobile:n})}},32222:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(12327),s=n(14041),o=n(3641);let a=()=>{r.Ru.loadAndActivate({locale:"en",messages:o.messages})},i=()=>{let e=(0,s.useRef)(!1);e.current||(a(),e.current=!0)}},67359:(e,t,n)=>{"use strict";n.d(t,{O:()=>a});var r=n(14041),s=n(64225),o=n(68973);let a=e=>{let t=(0,s.jL)();(0,r.useEffect)(()=>{t((0,o.dB)({locale:e||null}))},[e]),(0,r.useEffect)(()=>()=>{t((0,o.dB)({locale:null}))},[])}},28583:(e,t,n)=>{"use strict";n.d(t,{K:()=>o,gt:()=>i,ug:()=>a});var r=n(73893),s=n(42948);let o=e=>"/templates/categories/".concat(e),a=e=>{let{id:t,slug:n,absolute:s=!1}=e;return t?"".concat(s?r.$.FRONTEND_URL:"","/templates/").concat(n?"".concat(n,"-"):"").concat(t):""},i=e=>"en"!==e&&e&&s.jF.includes(e)?{home:"/".concat(e),pricing:"/".concat(e,"/pricing")}:{home:"/",pricing:"/pricing"}},40269:(e,t,n)=>{"use strict";n.d(t,{f:()=>x});var r=n(12784),s=n.n(r),o=n(69011),a=n.n(o),i=n(30795),l=n.n(i),d=n(32899),c=n(64225),u=n(65681),h=n(95941),p=n(76285);let f="custom",m="updates",g=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{},[n]=u.hL(e.db,[m]);return u.UK(n,u.T3(e._dbref,!1)).then(r=>{t(n),p.hL(e.doc,()=>{r.forEach(t=>p.QE(e.doc,t))},e,!1)}).then(()=>u.y7(n).then(t=>{e._dbref=t+1})).then(()=>u.U9(n).then(t=>{e._dbsize=t})).then(()=>n)},w=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return g(e).then(n=>{(t||e._dbsize>=500)&&u.GL(n,p.PR(e.doc)).then(()=>u.yH(n,u.U2(e._dbref,!0))).then(()=>u.U9(n).then(t=>{e._dbsize=t}))})},y=e=>u.MR(e);class A extends h.c{destroy(){return this._storeTimeoutId&&clearTimeout(this._storeTimeoutId),this.doc.off("update",this._storeUpdate),this.doc.off("destroy",this.destroy),this._destroyed=!0,this._db.then(e=>{e.close()})}clearData(){return this.destroy().then(()=>{u.MR(this.name)})}get(e){return this._db.then(t=>{let[n]=u.hL(t,[f],"readonly");return u.Jt(n,e)})}set(e,t){return this._db.then(n=>{let[r]=u.hL(n,[f]);return u.yJ(r,t,e)})}del(e){return this._db.then(t=>{let[n]=u.hL(t,[f]);return u.yH(n,e)})}constructor(e,t){super(),this.doc=t,this.name=e,this._dbref=0,this._dbsize=0,this._destroyed=!1,this.db=null,this.synced=!1,this._db=u.P2(e,e=>u.vK(e,[["updates",{autoIncrement:!0}],["custom"]])),this.whenSynced=this._db.then(e=>(this.db=e,g(this,e=>u.GL(e,p.PR(t))).then(()=>(this._destroyed||(this.emit("synced",[this]),this.synced=!0),this)))),this._storeTimeout=1e3,this._storeTimeoutId=null,this._storeUpdate=(e,t)=>{if(this.db&&t!==this){let[t]=u.hL(this.db,[m]);u.GL(t,e),++this._dbsize>=500&&(null!==this._storeTimeoutId&&clearTimeout(this._storeTimeoutId),this._storeTimeoutId=setTimeout(()=>{w(this,!1),this._storeTimeoutId=null},this._storeTimeout))}},t.on("update",this._storeUpdate),this.destroy=this.destroy.bind(this),t.on("destroy",this.destroy)}}var v=n(5933),b=n(26488),M=n(63025),S=n(5720);let C=(0,b.S)();class k{async enable(){}async disable(){}get enabled(){return C&&((0,S.yy)(this.store.getState())||d.of.get("offlineEditing"))}async loadYDoc(e,t){return this.enabled?!!(0,S.TT)(this.store.getState())[e]&&(this.setup(e,t),!0):(console.warn("Cannot setupForDocLoad when it is not enabled"),!1)}async syncYDoc(e,t){if(!this.enabled){console.warn("Cannot setup IndexedDB for doc as it is not enabled");return}await this.setup(e,t),this.store.dispatch((0,S.GD)({docId:e,lastSynced:new Date().toISOString()}))}setup(e,t){return new Promise(n=>{let r=new A(e,t),o=s()(()=>{let e=t.getMap("SCHEMA_VERSION").get("REQUIRED_VERSION");r.set("lastUpdated",new Date().toISOString()),r.set("schemaVersion",e||"")},1e3);t.on("update",o),r.on("synced",()=>{n()})})}async gc(){let e=Date.now(),t=Object.values(this.syncedYDocs).filter(t=>!!t.lastSynced&&e-new Date(t.lastSynced).getTime()>M.P).map(e=>e.docId),n=(0,v.pn)(this.store.getState());n?this.removeDocs(l()(t,n)):this.removeDocs(t)}async removeDocs(e){if(0===e.length)return;this.store.dispatch((0,S.jk)({docIds:e}));let t=e.map(e=>y(e));await Promise.all(t)}async debug(){return{syncedYdocs:this.syncedYDocs}}get syncedYDocs(){return(0,S.TT)(this.store.getState())}constructor(){this.store=(0,c.KA)()}}let x=a()(()=>new k)},26488:(e,t,n)=>{"use strict";n.d(t,{B:()=>o,S:()=>s});var r=n(88255);let s=()=>"indexedDB"in window&&"localStorage"in window&&r.P,o=()=>"undefined"!=typeof navigator&&"serviceWorker"in navigator&&s()},59025:(e,t,n)=>{"use strict";n.d(t,{Br:()=>h,Iy:()=>p,n6:()=>m,td:()=>f});var r=n(14041),s=n(35002),o=n(64225),a=n(5933),i=n(14e3),l=n(33684),d=n(63899);let c=e=>Math.random()<=1/e;class u{setupProvider(){this.t1SetupProvider||(this.t1SetupProvider=performance.now())}downloadDoc(){this.t2DownloadDoc||(this.t2DownloadDoc=performance.now())}onCreate(){this.t3OnCreate||(this.t3OnCreate=performance.now())}report(){return null===this.t1SetupProvider||null===this.t2DownloadDoc||null===this.t3OnCreate?null:{downloadDoc:this.t2DownloadDoc-this.t1SetupProvider,onCreate:this.t3OnCreate-this.t2DownloadDoc}}constructor(){this.t1SetupProvider=null,this.t2DownloadDoc=null,this.t3OnCreate=null}}let h=(e,t)=>{let n=(0,o.GV)(a.Cl),s=(0,r.useRef)(n);(0,r.useEffect)(()=>{s.current=n},[n]),(0,r.useEffect)(()=>{if(e)return window.addEventListener("keydown",n,!0),()=>{window.removeEventListener("keydown",n,!0)};function n(e){if(!e.target.closest(".ProseMirror")||!s.current||!c(t))return;let n=performance.now();requestAnimationFrame(()=>{let t=e.key;" "===t&&(t="Space");let r=performance.now()-n;(0,d.I1)({...(0,l.w)(),key:t,duration:r})})}},[e,s,t])},p=()=>{let e=(0,s.u)("rumSampleRate");(0,r.useEffect)(()=>{(0,d.BR)(e)},[e])},f=e=>{let t=(0,r.useCallback)(t=>{let{isFullscreen:n=!1}=t;if(!e)return;let r=performance.now();requestAnimationFrame(()=>{requestAnimationFrame(()=>{let e=performance.now()-r;(0,d.WX)({...(0,l.w)(),toMode:i.w.SLIDE_VIEW,duration:e,isFullscreen:n})})})},[e]);return{recordExitSlideModePerformance:(0,r.useCallback)(t=>{let{isFullscreen:n=!1}=t;if(!e)return;let r=performance.now();requestAnimationFrame(()=>{requestAnimationFrame(()=>{let e=performance.now()-r;(0,d.WX)({...(0,l.w)(),toMode:i.w.DOC_VIEW,duration:e,isFullscreen:n})})})},[e]),recordEnterSlideModePerformance:t}},m=()=>{let[e]=(0,r.useState)(()=>new u),t=(0,r.useCallback)(()=>{e.setupProvider()},[e]),n=(0,r.useCallback)(()=>{e.downloadDoc()},[e]);return{timeOnCreate:(0,r.useCallback)(()=>{e.onCreate();let t=e.report();if(null===t){console.warn("[HoneycombDocLoadTimer] failed to generate doc timings");return}(0,d.Ac)({...(0,l.w)(),duration:t.onCreate}),(0,d.Dx)({...(0,l.w)(),duration:t.downloadDoc})},[e]),timeOnSetupProvider:t,timeOnDownloadDoc:n}}},19408:(e,t,n)=>{"use strict";n.d(t,{R:()=>i});var r=n(31242),s=n(14041),o=n(85025),a=n(14691);let i=()=>{let{pathname:e,isReady:t}=(0,r.useRouter)(),n=(0,s.useRef)(!1),[i,l]=(0,o.F)(a.E.lastHomeUrl,"/");(0,s.useEffect)(()=>{!n.current&&t&&(l("/inspiration"===e||"/templates"===e?e:"/"),n.current=!0)},[l,t,e])}},91417:(e,t,n)=>{"use strict";let r,s;n.d(t,{W:()=>d});var o=n(14041),a=n(73893),i=n(35002),l=n(64225);Promise.all([n.e(5611),n.e(4483)]).then(n.bind(n,63617)).then(e=>{r=e.applyDevTools,s=e.removeDevTools});let d=e=>{let t=(0,l.GV)(i.Ew);(0,o.useEffect)(()=>{if(e){if(t){console.debug("[Prosemirror DevTools] Activating prosemirror-dev-tools");try{r(e.view)}catch(e){}}else try{s()}catch(e){}return a.$.DEBUG_ENABLED&&(window.openPMDT=()=>r(e.view)),()=>{s(),delete window.openPMDT}}},[e,t])}},77159:(e,t,n)=>{"use strict";n.d(t,{b:()=>u});var r=n(13236),s=n(81570),o=n(73686),a=n(78784),i=n(64225),l=n(20277),d=n(77646);let c=()=>{let e=document.createElement("span");e.classList.add("collaboration-cursor__caret","streaming-cursor"),e.setAttribute("style","border-color: var(--chakra-colors-trueblue-100)");let t=document.createElement("div");return t.classList.add("collaboration-cursor__label","streaming-cursor__label"),t.setAttribute("style","background-color: var(--chakra-colors-trueblue-100); color: var(--chakra-colors-trueblue-400)"),e.insertBefore(t,null),e},u=r.YY.create({name:"aiGeneration",addOptions:()=>({provider:null}),addStorage:()=>({generationEnabled:!1}),onCreate(){let{provider:e}=this.options;e&&e.awareness&&e.awareness.on("change",()=>{if(!e.awareness)return;let t=!1;for(let[n,r]of e.awareness.getStates())r.isStreaming&&n!==e.awareness.clientID&&(t=!0);let n=(0,i.KA)();(0,a.kg)(n.getState())!==t&&n.dispatch((0,a.gR)(t))})},addCommands(){return{setAIGenerationRunning:e=>()=>{var t,n;return this.storage.generationEnabled=e,null===(n=this.options.provider)||void 0===n||null===(t=n.awareness)||void 0===t||t.setLocalStateField("isStreaming",e),!0}}},addProseMirrorPlugins(){let{storage:e}=this;return[new s.k_({key:new s.hs("aiGeneration"),props:{decorations(t){if(!e.generationEnabled)return o.zF.empty;let n=[],s=t.doc.content.size-2,a=(0,r.eL)(t.doc.resolve(s),d.jg),i=a?(0,l.s)(t.doc.resolve(a.pos),-1):null;return i&&a&&(n.push(o.NZ.widget(i.from,c,{key:"sal",side:10})),n.push(o.NZ.node(a.pos,a.pos+a.node.nodeSize,{class:"ai-generate-streaming-card"}))),o.zF.create(t.doc,n)}}})]}})},9568:(e,t,n)=>{"use strict";n.d(t,{d:()=>i});var r=n(13236),s=n(81570),o=n(82883);let a=()=>new s.k_({key:o.G,state:{init:()=>new o.Z,apply:(e,t,n,r)=>t.apply(e,r)}}),i=r.YY.create({name:"aiModifications",onCreate(){this.options.document.on("afterAllTransactions",e=>{let t=o.G.getState(this.editor.view.state);t&&t.flushMoveInstructionQueue(this.editor.view.state)})},addProseMirrorPlugins:()=>[a()],addCommands:()=>({setInteractionRange:(e,t)=>n=>{let{tr:r}=n;return r.setMeta("aiModificationAction",{type:"setInteractionRange",rangeId:e,range:t}),!0}})})},64761:(e,t,n)=>{"use strict";n.d(t,{e:()=>m});var r=n(13236),s=n(81313),o=n(81570),a=n(73686),i=n(46568),l=n(9376),d=n(24643),c=n(9138),u=n(64225),h=n(95580),p=n(77646);let f=(e,t)=>new o.k_({props:{attributes:()=>{let e=(0,d.lh)((0,u.KA)().getState()),n=(null==e?void 0:e.type)==="deck";return t.salPanelOpen?{class:(0,s.cx)("sal-active",n&&"buddy-active-deck")}:{class:""}},decorations:n=>{let{doc:r,selection:f}=n;if(!e.isEditable)return;let{from:m,to:g}=f,w=[],y=(0,u.KA)().getState(),A=(0,i.yZ)(y);if((0,c.iZ)("image-chat")(y)&&A&&f instanceof o.nh)return w.push(a.NZ.node(f.from,f.to,{class:"is-selecting-node"})),a.zF.create(r,w);if(!t.salPanelOpen)return;let v=(0,d.lh)(y);return(null==v?void 0:v.type)==="deck"?l.r.findTopLevelCards(e).map(e=>{w.push(a.NZ.node(e.pos,e.pos+e.node.nodeSize,{class:(0,s.cx)("buddy-edit-deck")}))}):((0,h.IV)(f.$from,p.jg).forEach((e,t)=>{w.push(a.NZ.node(e.pos,e.pos+e.node.nodeSize,{class:(0,s.cx)(0==t?"sal-active-card":"sal-active-card-parent")}))}),(0,h.We)(e)||(f instanceof o.U3?w.push(a.NZ.inline(m,g,{class:(0,s.cx)("sal-selection-text")})):f instanceof o.nh&&w.push(a.NZ.node(m,g,{class:(0,s.cx)("sal-selection-node")})))),a.zF.create(r,w)}}}),m=r.YY.create({name:"salExtension",addStorage:()=>({salPanelOpen:!1}),addProseMirrorPlugins(){return[f(this.editor,this.storage)]},addCommands(){return{setSalOpen:e=>t=>{let{state:n,dispatch:r}=t;return this.storage.salPanelOpen=e,!0}}}})},73547:(e,t,n)=>{"use strict";n.d(t,{T:()=>T,A:()=>R});var r=n(3583),s=n(13236),o=n(12784),a=n.n(o),i=n(11329),l=n(35002),d=n(95941);class c extends d.c{[Symbol.iterator](){return this.yarray[Symbol.iterator]()}values(){let e=this.yarray.length,t=-1;return{[Symbol.iterator]:()=>({next(){return++t===e?{value:void 0,done:!0}:{value:this.yarray.get(t),done:!1}}})}}forEach(e){return this.yarray.forEach(e)}set(e,t){return this.doc.transact(n=>{this.map.has(e)&&this.delete(e),this.yarray.push([{key:e,val:t}])}),t}delete(e){let t=0;for(let n of this.yarray){if(n.key===e){this.yarray.delete(t);break}t++}}get(e){let t=this.map.get(e);return t&&t.val}has(e){return this.map.has(e)}constructor(e){super(),this.yarray=e,this.doc=e.doc,this.map=new Map;let t=e.toArray();this.doc.transact(n=>{for(let n=t.length-1;n>=0;n--){let r=t[n];this.map.has(r.key)?e.delete(n):this.map.set(r.key,r)}}),e.observe(t=>{let n=new Map,r=Array.from(t.changes.added);t.changes.deleted.forEach(e=>{e.content.getContent().forEach(e=>{this.map.get(e.key)===e&&(this.map.delete(e.key),n.set(e.key,{action:"delete",oldValue:e.val}))})});let s=new Map;r.map(e=>e.content.getContent()).flat().forEach(e=>{s.set(e.key,e)});let o=new Set,a=e.toArray();this.doc.transact(t=>{for(let t=a.length-1;t>=0&&(s.size>0||o.size>0);t--){let r=a[t];if(o.has(r.key))o.delete(r.key),e.delete(t,1);else if(s.get(r.key)===r){let e=this.map.get(r.key);if(e)o.add(r.key),n.set(r.key,{action:"update",oldValue:e.val,newValue:r.val});else{let e=n.get(r.key);e&&"delete"===e.action?n.set(r.key,{action:"update",newValue:r.val,oldValue:e.oldValue}):n.set(r.key,{action:"add",newValue:r.val})}s.delete(r.key),this.map.set(r.key,r)}else s.has(r.key)&&(o.add(r.key),s.delete(r.key))}}),n.size>0&&this.emit("change",[n])})}}class u{run(e){}}class h extends u{createKeyValue(e,t){return new c(e.getArray(t))}getRestoreMap(e){return e.getMap("annotationsAbsolute")}run(e){let t=this.createKeyValue(e,"annotationsAbsoluteKV");for(let[n,r]of this.getRestoreMap(e).entries())t.set(n,r)}constructor(...e){super(...e),this.name="AnnotationsYKeyValue"}}class p{runMigrations(){let e=this.getMigrationsMap();for(let t of this.migrations)if(!this.hasRunMigration(t.name))try{t.run(this.document),e.set(t.name,!0)}catch(e){}}getMigrationsMap(){return this.document.getMap(p.ANNOTATION_MIGRATIONS_KEY)}hasRunMigration(e){return this.getMigrationsMap().get(e)||!1}constructor(e){this.migrations=[new h],this.document=e,this.document.transact(()=>{this.runMigrations()}),this.annotations=this.document.getMap("annotations"),this.annotationsAbsolute=new c(this.document.getArray("annotationsAbsoluteKV"))}}p.ANNOTATION_MIGRATIONS_KEY="annotationMigrations";var f=n(81570);class m{get id(){return this.decoration.type.spec.id}get from(){return this.decoration.from}get data(){return this.decoration.type.spec.data}get HTMLAttributes(){return this.decoration.type.attrs}toString(){return JSON.stringify({id:this.id,data:this.data,from:this.from,HTMLAttributes:this.HTMLAttributes})}constructor(e){this.decoration=e}}var g=n(65202),w=n(54107),y=n(46108),A=n.n(y),v=n(66652),b=n.n(v),M=n(87835),S=n.n(M),C=n(73686),k=n(95580),x=n(96712),E=n(387),j=n(77646),D=n(17119);function I(e){let t=[];for(let n=e.length-1;n>=0;n--){let r=e[n];t.push({...r,prev:r.next,next:r.prev})}return t}class _{flushUndoQueue(){let{undoQueue:e}=this;return this.undoQueue=[],e}set(e,t){let n=this.map.get(e);return this.undoQueue.unshift({type:"set",key:e,next:n,prev:t}),this.map.set(e,t)}delete(e){let t=this.map.get(e);return void 0===t||this.undoQueue.unshift({type:"set",key:e,next:t,prev:void 0}),this.map.delete(e)}constructor(e){this.map=e,this.undoQueue=[]}}class P{persistRestoreMap(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={deletion:0,relToAbs:0,setting:0,total:0},r=performance.now();(t||this.hasChanges)&&(this.transactYDoc(()=>{let t=performance.now();for(let{key:e}of this.restoreMap)this.restoreMap.delete(e);n.deletion=performance.now()-t,this.map.forEach(t=>{let{id:r,pos:s,data:o}=t;try{let t=performance.now(),a=this.relToAbs(e,s);n.relToAbs+=performance.now()-t;let i=performance.now();this.restoreMap.set(r,{id:r,data:o,absPos:a}),n.setting+=performance.now()-i}catch(e){console.error("[Annotations] persistRestoreMap error: ",e.message)}})}),n.total=performance.now()-r,this.log("[Annotations] persistRestoreMap in ".concat(n.total,"ms"),{values:this.restoreMap.yarray.toArray(),performance:n}),this.hasChanges=!1)}flushMoveInstructionQueue(){let{moveInstructionMap:e}=this;return this.moveInstructionMap={},Object.values(e)}clearCutData(){this.cutData=null,this.filmstripCutData=null}getAnnotationsBetween(e,t,n){let r=[];for(let s of this.map.values())try{let o=this.relToAbs(e,s.pos);if(null===o)continue;t<=o&&o<n&&r.push({id:s.id,data:s.data,pos:o,relativePos:s.pos})}catch(e){console.warn("[Annotations] getAnnotationsBetween error: ",e.message)}return r}apply(e,t){if((0,E.LP)(e)){try{this.createDecorations(t)}catch(e){console.warn("[Annotations] handle remote change, not create decorations: ".concat(e.message))}return this}let n=e.getMeta(g.q);if(n){switch(n.type){case"addAnnotation":this.addAnnotation(n,t);break;case"restoreAnnotations":this.restoreAnnotations(n);break;case"clearAnnotations":this.clearAnnotations();break;case"deleteAnnotation":this.deleteAnnotation(n.id);break;case"refreshAnnotationDecorations":try{this.createDecorations(t)}catch(e){console.warn("could not create decorations: ".concat(e.message))}break;case"moveAnnotations":this.moveAnnotations(t,n.toMove)}return this.hasChanges=!0,this}switch(e.getMeta("uiEvent")){case"cut":this.handleCutTransaction(t,e);break;case"paste":this.handlePasteTransaction(t,e)}let r=e.getMeta("annotationEvent");switch(null==r?void 0:r.type){case"split-card":this.handleSplitCard(t,e,r);break;case"split-block":this.handleSplitBlock(t,e,r);break;case"join-forward":this.handleJoinForward(t,e,r);break;case"join-backward":this.handleJoinBackward(t,e,r);break;case"update-node-attrs":this.handleUpdateNodeAttrs(t,e,r);break;case"rearrange-cards":this.handleRearrangeCards(t,e,r);break;case"move":this.handleMove(t,e,r);break;case"merge-cards":this.handleMergeCards(t,e,r);break;case"drop":this.handleDropAnnotations(t,e,r);break;case"unwrap-node":this.handleUnwrapNode(t,e,r);break;case"wrap-nodes":this.handleWrapNodes(t,e,r);break;case"filmstrip-cut":this.handleFilmstripCut(t,e,r);break;case"filmstrip-paste":this.handleFilmstripPaste(t,e,r);break;default:e.getMeta("appendedTransaction")||(this.handleReplaceTransaction(t,e),this.handleReplaceAroundTransaction(t,e))}return e.docChanged&&(this.hasChanges=!0),this.handleLocalChange(e)}restore(e,t){t.forEach(t=>{let{next:n,key:r}=t;void 0===n?this.map.delete(r):this.map.set(r,{...n,pos:this.refreshRelativePos(e,n.pos)})}),this.persistRestoreMap(e,!0)}handleUnwrapNode(e,t,n){let{pos:r}=n,s=t.before.resolve(r),o=s.start(s.depth+1),a=t.before.resolve(o).end(),i=this.getAnnotationsBetween(e,o,a).map(t=>{let{id:n,relativePos:s}=t,a=this.relToAbs(e,s);return null===a?null:{id:n,newPos:r+(a-o)}}).filter(e=>!!e);this.log("%c[Annotations] unwrap node","color: green",{tr:t,pos:r,start:o,end:a,toMove:i}),i.length>0&&this.enqueueMoveInstructions(i)}handleWrapNodes(e,t,n){let{start:r,end:s,level:o}=n,a=this.getAnnotationsBetween(e,r,s).map(e=>{let{id:t,pos:n}=e;return{id:t,newPos:n+o}}).filter(e=>!!e);this.log("%c[Annotations] wrap nodes","color: green",{tr:t,start:r,end:s,toMove:a}),a.length>0&&this.enqueueMoveInstructions(a)}handleMergeCards(e,t,n){let{insertPos:r,contentPos:s}=n,o=t.before.nodeAt(s);if(!o){console.error("[AnnotationState] trying to merge cards, but cannot resolve content wrapper");return}let a=this.getAnnotationsBetween(e,s,s+o.nodeSize).map(e=>{let{id:t,pos:n}=e;return{id:t,newPos:r+(n-s-1)}});this.log("%c[Annotations] merge cards","color: green",{transaction:t,insertPos:r,contentPos:s,toMove:a}),a.length>0&&this.enqueueMoveInstructions(a)}handleRearrangeCards(e,t,n){let{rearrangedCardPositions:r,insertPos:s}=n,o=r.flatMap(n=>{let{newPos:r,oldPos:s}=n,o=t.before.resolve(s);return this.getAnnotationsBetween(e,s,s+o.nodeAfter.nodeSize).map(e=>{let{id:t,pos:n}=e;return{id:t,newPos:r+(n-s)}})}),a=[],i=(0,j.aJ)(t.before);if(i){let n=r[0].oldPos,o=Math.min(n,s),l=Math.max(n,s);a=i.flatMap(n=>{let{node:s,pos:a}=n;if(!(a>=o&&a<=l&&!r.find(e=>e.id===s.attrs.id)))return[];{let n=t.before.resolve(a),r=a+n.nodeAfter.nodeSize;return this.getAnnotationsBetween(e,a,r).map(e=>{let{id:n,pos:r}=e;return{id:n,newPos:t.mapping.map(r)}})}})}this.log("%c[Annotations] rearrange cards","color: green",{transaction:t,rearrangedCardPositions:r,annotationsInRearrangedCards:o,jumpedAnnotations:a});let l=[...o,...a];l.length>0&&this.enqueueMoveInstructions(l)}handleMove(e,t,n){let{insertPos:r,insertPosRaw:s,pos:o,end:a}=n,i=this.getAnnotationsBetween(e,o,a).map(e=>{let{id:t,pos:n}=e;return{id:t,newPos:r+(n-o)}}),l=this.getAnnotationsBetween(e,Math.min(s,a),Math.max(s,o)).map(e=>{let{id:n,pos:r}=e;return{id:n,newPos:t.mapping.map(r)}});this.log("%c[Annotations] move","color: green",{transaction:t,insertPos:r,insertPosRaw:s,pos:o,end:a,annotationsInCard:i,jumpedAnnotations:l});let d=[...i,...l];d.length>0&&this.enqueueMoveInstructions(d)}handleUpdateNodeAttrs(e,t,n){let{pos:r}=n,s=t.doc.nodeAt(r);if(!s)return;let o=this.getAnnotationsBetween(e,r,r+s.nodeSize).map(e=>{let{id:t,pos:n}=e;return{id:t,newPos:n}});this.log("%c[Annotations] update node attrs","color: green",{transaction:t,pos:r,toMove:o}),o.length>0&&this.enqueueMoveInstructions(o)}handleJoinBackward(e,t,n){let{atBeginning:r,joinPos:s}=n;if(!r)return;let o=t.before.resolve(s),a=t.before.resolve(o.before()),i=a.nodeBefore,l=a.nodeAfter;if(!i||!l)return;let d=a.pos+l.nodeSize,c=a.pos-i.nodeSize,u=e.selection.from;this.log("%c[Annotations] join backward","color: green",{transaction:t,prevBlock:i,nextBlock:l,nextBlockPos:a.pos,nextBlockEnd:d,prevBlockPos:c,joinPoint:u});let h=this.getAnnotationsBetween(e,a.pos,d);if(0===h.length){this.enqueueRefreshDecorations();return}0===l.content.size?(h.forEach(e=>{let{id:t}=e;return this.undoableMap.delete(t)}),requestAnimationFrame(()=>{this.writeUndoStack(e)})):this.enqueueMoveInstructions(h.map(e=>{let{id:t,pos:n}=e,r=Math.max(n-a.pos-1,0);return{id:t,newPos:(0===i.content.size?c:u)+r}}))}handleJoinForward(e,t,n){let{atEnd:r,joinPos:s}=n;if(!r)return;let o=t.before.resolve(s),{pos:a,node:i}=(0,k.TK)(o,e=>e.isBlock)[0],l=t.before.resolve(o.after()),d=l.nodeAfter;if(!d)return;let c=l.pos+d.nodeSize;this.log("%c[Annotations] join forward","color: green",{sel:e.selection,prevBlock:i,transaction:t,deleteAnnotations:!!d.isAtom,joinPos:o.pos,prevBlockPos:a,nextBlockPos:l.pos,nextBlock:d});let u=this.getAnnotationsBetween(e,a,a+i.nodeSize),h=this.getAnnotationsBetween(e,l.pos,c);if(0===h.length&&0===u.length){this.enqueueRefreshDecorations();return}let p=t=>{t.forEach(e=>{let{id:t}=e;return this.undoableMap.delete(t)}),requestAnimationFrame(()=>{this.writeUndoStack(e)})};d.isAtom&&i.content.size>0?p(h):0===i.content.size?p(u):this.enqueueMoveInstructions(h.map(e=>{let{id:t,pos:n}=e,r=Math.max(n-l.pos-1,0);return{id:t,newPos:(0===i.content.size?a:s)+r}}))}handleSplitBlock(e,t,n){let{splitPos:r,atBeginning:s}=n;if(s){this.enqueueRefreshDecorations();return}let o=t.before.resolve(r),{pos:a,node:i}=(0,k.TK)(o,e=>e.isBlock)[0],{$from:l}=e.selection,d=(0,k.TK)(l,e=>e.isBlock)[0],c=this.getAnnotationsBetween(e,r,a+i.nodeSize).map(e=>{let{id:t,pos:n}=e,s=n-r;return{id:t,newPos:d.pos+(0===s?s:s+1)}});c.length>0?this.enqueueMoveInstructions(c):this.enqueueRefreshDecorations(),this.log("%c[Annotations] split block","color: green",{sel:e.selection,transaction:t,splitPos:r,toMove:c,$before:o})}handleSplitCard(e,t,n){let{splitPos:r}=n,s=t.before.resolve(r),o=(0,k.TK)(s,j.jg)[0];if(!o)return;let a=o.pos,i=o.pos+o.node.nodeSize,l=this.getAnnotationsBetween(e,a,i).map(e=>{let{id:n,pos:s}=e;return{id:n,newPos:s===r?t.mapping.map(s+1)-1:t.mapping.map(s)}});this.log("%c[Annotations] split card","color: green",{transaction:t,splitPos:r,parentEnd:i,toMove:l}),this.enqueueMoveInstructions(l)}handlePasteTransaction(e,t){if(!this.cutData&&!this.filmstripCutData)return;let n=t.steps.find(e=>"replace"===e.jsonID);if(!n)return;let{from:r,to:s,slice:{openStart:o}}=n,a=e.doc.resolve(n.from),i=s===r?r:r+1,l=null==a.nodeBefore&&a.parent.isBlock,d=!o||l;if(this.log("%c[Annotations] paste transaction","color: green",{transaction:t,insertPos:r,resolved:a,isPasteBeginning:l,pasteType:this.cutData?"cut":"filmstrip-cut"}),this.cutData){let e=this.cutData;this.cutData=null;let t=e.toMove.map(e=>{let{id:t,offset:n}=e;return{id:t,newPos:i+(d?n:Math.max(0,n))}});t&&t.length>0&&(this.log("[Annotations] paste from cut final move",t),this.enqueueMoveInstructions(t))}else if(this.filmstripCutData){let n=this.filmstripCutData;this.filmstripCutData=null;let r=i-1;for(;r<e.doc.nodeSize;){let t=e.doc.nodeAt(r);if(t&&(0,j.jg)(t))break;r++}let s=this.getMoveInstructionsForFilmstripPaste(t,n,r);s&&s.length>0&&(this.log("[Annotations] paste from filmstrip cut final move",s),this.enqueueMoveInstructions(s))}}getMoveInstructionsForFilmstripPaste(e,t,n){if(!t)return;let r=(0,s.xe)(e.doc,j.jg);if(!r)return;let o=e.doc.resolve(n).depth,a=r.filter(t=>{let{pos:n}=t;return e.doc.resolve(n).depth===o}),i=a.findIndex(e=>e.pos===n);if(-1===i)return;let l=a.slice(i);return t.flatMap(e=>{let{cardIndex:t,annotations:n}=e;return n.map(e=>{let{id:n,offset:r}=e,s=l[t];if(s)return{id:n,newPos:s.pos+r}}).filter(e=>!!e)})}handleFilmstripPaste(e,t,n){if(!this.cutData&&!this.filmstripCutData)return;let{insertPos:r}=n;if(this.cutData){let e=this.cutData;this.cutData=null;let n=e.toMove.map(e=>{let{id:t,offset:n}=e;return{id:t,newPos:r+n}});n&&n.length>0&&(this.log("[Annotations] filmstripPaste from cut final move",{tr:t,cutData:e,moveInstructions:n}),this.enqueueMoveInstructions(n))}else if(this.filmstripCutData){let e=this.filmstripCutData;this.filmstripCutData=null;let n=this.getMoveInstructionsForFilmstripPaste(t,e,r);n&&n.length>0&&(this.log("%c[Annotations] filmstripPaste from filmstrip cut final move","color: green",{tr:t,filmstripCutData:e,moveInstructions:n}),this.enqueueMoveInstructions(n))}}handleFilmstripCut(e,t,n){this.cutData=null,this.filmstripCutData=n.deleted.map(n=>{let{cardIndex:r,pos:s}=n,o=t.before.resolve(s),a=s+o.nodeAfter.nodeSize;return{cardIndex:r,annotations:this.getAnnotationsBetween(e,s,a).map(e=>{let{id:t,pos:n}=e;return{id:t,offset:n-s}})}}),this.log("%c[Annotations] filmstripCut","color: green",{tr:t,filmstripCutData:this.filmstripCutData})}handleCutTransaction(e,t){let n=t.steps.find(e=>"replace"===e.jsonID);if(!n)return;this.filmstripCutData=null;let{from:r,to:s}=n,o=e.doc.resolve(r),a=null==o.nodeAfter&&null==o.nodeBefore&&o.parent.isBlock,i=this.getAnnotationsBetween(e,r-(a?1:0),s),l=i.map(t=>{let n=this.relToAbs(e,t.relativePos);return{id:t.id,offset:n-r}});this.cutData={slice:n.slice,toMove:l},this.log("%c[Annotations] cut transaction","color:green",{isWholeBlock:a,resolved:o,transaction:t,annotations:i,moveData:l})}handlePrependContentToBlock(e,t){let n=t.steps.find(e=>"replace"===e.jsonID);if(!n)return;let{from:r}=n,s=t.before.resolve(r);if(!s.nodeAfter)return;let o=this.getAnnotationsBetween(e,r,r+s.nodeAfter.nodeSize).map(n=>{let{id:s,relativePos:o}=n,a=this.relToAbs(e,o);return{id:s,newPos:a===r?t.mapping.map(a+1)-1:t.mapping.map(a)}});o.length>0&&(this.log("%c[Annotations] replace transaction - prepend content","color:green",{tr:t,annotationsToMove:o}),this.enqueueMoveInstructions(o))}handleReplaceTransaction(e,t){let n=t.steps.find(e=>"replace"===e.jsonID);if(!n)return;let{from:r,to:s}=n,o=t.before.resolve(r),a=t.before.resolve(s),i=o.parent!==a.parent,l=0==n.slice.content.size,d=0===o.parentOffset&&s>=r+o.parent.nodeSize-2,c=d&&l;if(0===a.parentOffset&&a.depth===o.depth+1&&a.pos-o.pos==1)return this.handlePrependContentToBlock(e,t);let u=!1;if(i){var h;let n=[...c?[]:this.getAnnotationsBetween(e,r-o.parentOffset-1,r).map(t=>{let{id:n,relativePos:r}=t;return{id:n,newPos:this.relToAbs(e,r)}}),...this.getAnnotationsBetween(e,s,s+(null===(h=a.nodeAfter)||void 0===h?void 0:h.nodeSize)+1).map(n=>{let{id:r,relativePos:s}=n;return{id:r,newPos:t.mapping.map(this.relToAbs(e,s))}})];this.log("[Annotations] multiline to move",n),n.length>0&&(u=!0,this.enqueueMoveInstructions(n))}let p=this.getAnnotationsBetween(e,r-(c||i&&0===o.parentOffset?1:0),s);p.length>0&&(u=!0,this.log("[Annotations] to delete",p),p.forEach(e=>{this.undoableMap.delete(e.id)})),u&&(this.log("%c[Annotations] replace transaction","color:green",{tr:t,annotationsToDelete:p,isWholeBlock:c,isMultiline:i,replacingEntireFromBlock:d,replacingWithNothing:l}),requestAnimationFrame(()=>{this.writeUndoStack(e)}))}handleReplaceAroundTransaction(e,t){let n=b()(t.steps.filter(e=>"replaceAround"===e.jsonID),t=>{let{from:n,to:r}=t;return this.getAnnotationsBetween(e,n,r)}),r=S()(n,e=>e.id).map(e=>{let{id:n,pos:r}=e;return{id:n,newPos:t.mapping.map(r)}});return r.length>0&&this.log("%c[Annotations] replaceAround transaction","color:green",{tr:t,moveInsturctions:r}),0!==r.length&&(this.enqueueMoveInstructions(r),!0)}clearAnnotations(){this.transactYDoc(()=>{this.map.forEach((e,t)=>{this.map.delete(t)})})}restoreAnnotations(e){this.log("%c[Annotations] restoreAnnotations","color: green",e);let{toRestore:t}=e;this.clearAnnotations(),this.enqueueMoveInstructions(t.filter(e=>{let{absPos:t}=e;return null!=t}).map(e=>{let{absPos:t,id:n}=e;return{id:n,newPos:t}}))}addAnnotation(e,t){this.log("%c[Annotations] addAnnotation","color: green",e);let{pos:n,id:r,data:s}=e,o=this.absToRel(t,n);this.map.set(r,{id:r,pos:o,data:s})}deleteAnnotation(e){this.log("%c[Annotations] deleteAnnotation","color: green",e),this.map.delete(e)}moveAnnotations(e,t){let{map:n}=this;this.log("%c[Annotations] moveAnnotations","color: green",t),this.transactYDoc(()=>{t.forEach(t=>{let{id:r,newPos:s}=t,o=n.get(r)||{id:r};this.undoableMap.set(r,{...o,pos:this.absToRel(e,s)})})}),this.writeUndoStack(e)}writeUndoStack(e){let t=r.Mj.getState(e).undoManager;if(0===t.undoStack.length)return;let n=this.undoableMap.flushUndoQueue();if(0===n.length)return;let s=t.undoStack[t.undoStack.length-1],o="annotations",a=s.meta.get(o)||[];a.length>0&&this.log("[Annotations] existing undo stack",{existing:a,toWrite:n,stack:t.undoStack});let i=[...n,...a];s.meta.set(o,i),this.log("[Annotations] writing to undo stack",i)}createDecorations(e){let{map:t}=this.options;this.refreshDecorations=!1;let n=[],r=[];t.forEach((t,s)=>{let o=(0,x.d_)(e,t.pos);if(null==o)return;let a=e.doc.nodeAt(o);a&&((null==a?void 0:a.isInline)?n.push(C.NZ.inline(o,o+1,{class:"debug-comment-cursor"})):n.push(C.NZ.node(o,o+a.nodeSize,{class:"debug-comment-block"}))),r.push({id:s,data:t.data,relativePos:t.pos,pos:o})}),e.doc.descendants((e,t,s)=>!!(!(t>0)||(0,D.cE)(s)||(0,D.cE)(e))&&(r.filter(n=>n.pos>=t&&n.pos<t+e.nodeSize).forEach(r=>{let{id:s,data:o}=r;n.push(C.NZ.node(t,t+e.nodeSize,{},{isAnnotation:!0,id:s,data:o}))}),!0)),this.decorations=C.zF.create(e.doc,n),this.annotations=r}handleDropAnnotations(e,t,n){let{dragging:{origNodePos:r,inBlock:s,inCard:o},droppedBlockPos:a}=n,i=[];s.forEach(e=>{let t=e.pos-r;i.push({id:e.id,newPos:a+t})}),this.getAnnotationsBetween(e,a,a+1).filter(e=>!i.find(t=>t.id===e.id)).forEach(e=>{i.push({id:e.id,newPos:t.mapping.map(e.pos)})}),o.filter(e=>!i.find(t=>t.id===e.id)).forEach(e=>{let n=t.mapping.map(e.pos);i.push({newPos:n,id:e.id})}),this.log("%c[Annotations] handleDropAnnotations","color: green",{action:n,tr:t,toMove:i}),i.length>0&&this.enqueueMoveInstructions(i)}handleLocalChange(e){let t=[...this.decorations.find(void 0,void 0,e=>e.isAnnotation&&this.moveInstructionMap[e.id])],n=this.decorations.remove(A()(t)).map(e.mapping,e.doc).add(e.doc,t);return this.decorations=n,this}absToRel(e,t){let n=(0,x.JO)(e,t);if(!n)throw Error("Y.State non initialized");return n}relToAbs(e,t){return(0,x.d_)(e,t)}refreshRelativePos(e,t){let{doc:n,type:s,binding:o}=r.pJ.getState(e),a=(0,w.bL)(n,s,t,o.mapping);return(0,w.Bw)(a,s,o.mapping)}enqueueMoveInstructions(e){e.forEach(e=>{this.moveInstructionMap[e.id]&&console.error("[AnnotationState] trying to enqueue two move instructions for annotation with targetId=".concat(e.id)),this.moveInstructionMap[e.id]=e})}enqueueRefreshDecorations(){this.refreshDecorations=!0}transactYDoc(e){this.options.document.transact(e)}log(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l.of.get("debugComments")?console.log(...t):console.debug(...t)}constructor(e){this.options=e,this.decorations=C.zF.empty,this.annotations=[],this.refreshDecorations=!1,this.hasChanges=!1,this.filmstripCutData=null,this.cutData=null,this.moveInstructionMap={},this.map=e.map,this.restoreMap=e.restoreMap,this.undoableMap=new _(this.map)}}let O=e=>{let t=a()(e=>{g.q.getState(e.state).persistRestoreMap(e.state)},500);return new f.k_({key:g.q,state:{init:()=>new P(e),apply:(e,t,n,r)=>t.apply(e,r)},view:()=>({update(e){t(e)}}),props:{transformPasted(t){var n;let r=this.getState(e.editor.state),s=null===(n=t.content.firstChild)||void 0===n?void 0:n.attrs.docId;return s&&s!==e.editor.gammaDocId&&r.clearCutData(),t},handleDOMEvents:{copy(e){return this.getState(e.state).clearCutData(),!1}},decorations(t){let{decorations:n,annotations:r}=this.getState(t);return e.onUpdate&&e.onUpdate(n.find().map(e=>new m(e)),r),n}}})},T=s.YY.create({name:"annotation",onCreate(){let e=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l.of.get("debugComments")?console.log(...t):console.debug(...t)};this.options.document.on("afterAllTransactions",t=>{let n=g.q.getState(this.editor.view.state),r=n.flushMoveInstructionQueue();r.length>0?(e("%c[Annotations] afterAllTransactions handling queued moves","color:pink",r),this.editor.commands.moveAnnotations(r)):n.refreshDecorations&&(e("%c[Annotations] afterAllTransactions refreshDecorations","color:pink"),this.editor.commands.refreshDecorations())});let t=g.q.getState(this.editor.state);window.gammaAnnotations=t;let n=r.Mj.getState(this.editor.state).undoManager;setTimeout(()=>{n.on("stack-item-popped",e=>{let r=e.stackItem.meta.get("annotations");if(!r){t.persistRestoreMap(this.editor.state,!0);return}let{undoStack:s,redoStack:o}=n;"undo"===e.type&&o.length>0?o[o.length-1].meta.set("annotations",I(r)):"redo"===e.type&&s.length>0&&s[s.length-1].meta.set("annotations",I(r)),t.restore(this.editor.state,r)})},0),t.map.observe(a()(()=>{e("[Annotations] map observe -> resfreshDecorations"),this.editor.commands.refreshDecorations()})),this.editor.commands.refreshDecorations()},addCommands:()=>({restoreAnnotations:e=>t=>{let{dispatch:n,tr:r}=t;return n&&(r.setMeta(g.q,{type:"restoreAnnotations",toRestore:Object.values(e)}),n(r)),!0},updateAttributes:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n=>{var r,o;let{tr:a,state:i,dispatch:l}=n,d=null,c=null,u=(r="string"==typeof e?e:e.name,(o=i.schema).nodes[r]?"node":o.marks[r]?"mark":null);return!!u&&("node"===u&&(d=(0,s.Pg)(e,i.schema)),"mark"===u&&(c=(0,s.I2)(e,i.schema)),l&&a.selection.ranges.forEach(e=>{let n=e.$from.pos,r=e.$to.pos;i.doc.nodesBetween(n,r,(e,s)=>{d&&d===e.type&&a.setNodeMarkup(s,void 0,{...e.attrs,...t}).setMeta("annotationEvent",{type:"update-node-attrs",pos:s}),c&&e.marks.length&&e.marks.forEach(o=>{if(c===o.type){let i=Math.max(s,n),l=Math.min(s+e.nodeSize,r);a.addMark(i,l,c.create({...o.attrs,...t}))}})})}),!0)}},wrapWithAnnotations:(e,t)=>n=>{let{state:r,tr:s,dispatch:o}=n,a=r.schema.nodes[e],{$from:l,$to:d}=r.selection,c=l.blockRange(d),u=c&&(0,i.oM)(c,a,t);if(!u||!c)return!1;let{start:h,end:p}=c;return!o||(s.wrap(c,u).setMeta("annotationEvent",{type:"wrap-nodes",start:h,end:p,level:1}).scrollIntoView(),!0)},moveAnnotations:e=>t=>{let{dispatch:n,tr:r}=t;return n&&(r.setMeta(g.q,{type:"moveAnnotations",toMove:e}),n(r)),!0},clearAnnotations:()=>e=>{let{dispatch:t,tr:n}=e;return t&&(n.setMeta(g.q,{type:"clearAnnotations"}),t(n)),!0},refreshDecorations:()=>e=>{let{dispatch:t,tr:n}=e;return t&&(n.setMeta(g.q,{type:"refreshAnnotationDecorations"}),t(n)),!0},addAnnotation:e=>{let{pos:t,id:n,data:r}=e;return e=>{let{dispatch:s,state:o}=e;return s&&o.tr.setMeta(g.q,{type:"addAnnotation",id:n,data:r,pos:t}),!0}},deleteAnnotation:e=>t=>{let{dispatch:n,state:r}=t;return n&&r.tr.setMeta(g.q,{type:"deleteAnnotation",id:e}),!0}}),addProseMirrorPlugins(){let{document:e,onUpdate:t}=this.options,n=new p(e);return[O({document:e,editor:this.editor,map:n.annotations,restoreMap:n.annotationsAbsolute,onUpdate:t})]}}),R=T},96237:(e,t,n)=>{"use strict";n.d(t,{$:()=>o});var r=n(13236),s=n(76241);let o=r.YY.create({name:"draftComments",addCommands:()=>({removeDraftComments:e=>t=>{let{dispatch:n,tr:r}=t;if(n){let t={type:"removeDraftComment",comments:Array.isArray(e)?e:[e]};r.setMeta(s._,t),n(r)}return!0},createDraftComment:e=>t=>{let{dispatch:n,tr:r}=t;return n&&(r.setMeta(s._,{type:"createDraftComment",comment:e}),n(r)),!0}}),addProseMirrorPlugins:()=>[(0,s.h)()]})},6165:(e,t,n)=>{"use strict";n.d(t,{$:()=>c});var r=n(13236),s=n(17119),o=n(81570),a=n(73686),i=n(44507);let l=new o.hs("mobileAnnotationPluginKey");class d{apply(e,t){let n=e.getMeta(l);return n&&"setPos"in n&&(this.pos=n.setPos),this}constructor(){this.pos=null}}let c=r.YY.create({name:"mobileAnnotation",addCommands:()=>({setMobileAddBlockComment:e=>t=>{let{dispatch:n,tr:r,view:o}=t;if(!n)return!1;if(null===e)return r.setMeta(l,{setPos:null}),n(r),!0;let{clientX:a,clientY:i}=e,d=o.posAtCoords({left:a,top:i});if(null===d)return!0;let c=(0,s.CS)(d.inside,o);if(!c)return!1;let u=o.coordsAtPos(c.pos),h=a-u.left,p=i-u.top;return r.setMeta(l,{setPos:{pos:c.pos,end:c.end,offsetX:h,offsetY:p}}),n(r),!0}}),addProseMirrorPlugins(){var e;return[(e=this.editor,new o.k_({key:l,state:{init:()=>new d,apply:(e,t,n,r)=>t.apply(e,r)},props:{handleDOMEvents:{click(t,n){if(!(0,i.Xb)())return!1;if(n.target.closest("[data-comments-wrapper]"))return;let r=l.getState(t.state);r.pos||(r.timeout?(clearTimeout(r.timeout),r.timeout=null,e.commands.setMobileAddBlockComment(n)):r.timeout=setTimeout(()=>{r.timeout=null},300))}},decorations(e){let t=l.getState(e).pos;if(null===t)return a.zF.empty;let n=a.NZ.node(t.pos,t.end,{},{isMobileAnnotation:!0,type:"show-buttons",offsetX:t.offsetX,offsetY:t.offsetY});return a.zF.create(e.doc,[n])}}}))]}})},24502:(e,t,n)=>{"use strict";n.d(t,{c:()=>f});var r=n(3583),s=n(13236),o=n(12784),a=n.n(o),i=n(11329),l=n(45214),d=n(35002),c=n(64225),u=n(10458),h=n(80245),p=n(77646);let f=s.YY.create({name:"editCardAI",onTransaction(e){var t;let{transaction:n}=e;if(!(!n.docChanged||n.getMeta("isEditCardVariant"))&&this.editor.isEditable&&d.of.get("editCard2")){if(null===(t=n.getMeta(r.pJ))||void 0===t?void 0:t.isUndoRedoOperation)g(n);else{if(!1===n.getMeta("addToHistory"))return;m(n)}}}}),m=a()(e=>{try{let t=(0,c.KA)(),n=t.getState(),r=(0,l.yL)(n);if(0===Object.keys(r).length)return;(0,h.A)(e).forEach(n=>{let o={from:n.newStart,to:n.newEnd},a=(0,s.Nx)(e.doc,o,e=>(0,p.jg)(e)&&!!r[e.attrs.id]);a.length&&a.forEach(e=>{var n;let{node:s}=e,o=s.attrs.id;console.debug("Clearing suggestions for card",o),null===u.zS||void 0===u.zS||u.zS.track(u.VV.AI_CARD_VARIATION_KEPT,{cardId:o,variantId:r[o].selected,isOriginal:null===(n=r[o].variants.find(e=>e.id===r[o].selected))||void 0===n?void 0:n.isOriginal,interactionId:r[o].interactionId,source:"edit"}),t.dispatch((0,l.YB)({cardId:o}))})})}catch(e){console.error("[caught] EditCard clearSuggestions error",e)}},250),g=e=>{try{let t=e.steps[0];if(!t||!(t instanceof i.Ln))return;let n=t.slice.content,r=(0,c.KA)(),s=r.getState(),o=(0,l.yL)(s);if(0===Object.keys(o).length)return;n.descendants(e=>{if(!(0,p.jg)(e))return;let t=e.attrs.id,n=o[t];if(!n)return;let s=n.variants.find(t=>JSON.stringify(t.card)===JSON.stringify(e.toJSON()));s&&r.dispatch((0,l.S6)({cardId:t,variantId:s.id}))})}catch(e){console.error("[caught] EditCard updateVariations error",e)}}},53478:(e,t,n)=>{"use strict";n.d(t,{p:()=>o});var r=n(13236),s=n(77646);let o=r.YY.create({name:"generateCard",addCommands:()=>({removeGeneratorInputsOnLoad:()=>e=>{let{tr:t,state:n,editor:o}=e;return!!o.isEditable&&((0,r.xe)(n.doc,e=>{var t;return(0,s.jg)(e)&&(null===(t=e.attrs.generatorInput)||void 0===t?void 0:t.status)==="done"}).forEach(e=>{let{pos:n}=e;t.setNodeAttribute(n,"generatorInput",null)}),!0)}})})},44984:(e,t,n)=>{"use strict";n.d(t,{F:()=>i});var r=n(13236),s=n(81570),o=n(43873);let a=()=>new s.k_({key:new s.hs("undoHistoryPlugin"),appendTransaction(e,t,n){if(e.some(e=>!1==e.getMeta("addToHistory"))){let e=n.tr;return e.setMeta("addToHistory",!1),e}return null}}),i=r.YY.create({name:"undoHistory",priority:o.y.UndoHistory,addProseMirrorPlugins:()=>[a()],addCommands:()=>({noUndo:()=>e=>{let{tr:t}=e;return t.setMeta("addToHistory",!1),!0}})})},64972:(e,t,n)=>{"use strict";n.d(t,{O:()=>l});var r=n(3583),s=n(67965),o=n(70628),a=n(13236),i=n(43873);let l=a.YY.create({name:"collaboration",priority:i.y.Collaboration,addOptions:()=>({document:null,field:"default",fragment:null}),onCreate(){this.editor.extensionManager.extensions.find(e=>"history"===e.name)&&console.warn('[tiptap warn]: "@tiptap/extension-collaboration" comes with its own history support and is not compatible with "@tiptap/extension-history".')},addCommands:()=>({undo:()=>e=>{let{tr:t,state:n,dispatch:o}=e;return t.setMeta("preventDispatch",!0),0!==r.Mj.getState(n).undoManager.undoStack.length&&(!o||(0,s.tN)(n)||!0)},redo:()=>e=>{let{tr:t,state:n,dispatch:o}=e;return t.setMeta("preventDispatch",!0),0!==r.Mj.getState(n).undoManager.redoStack.length&&(!o||(0,s.ZS)(n)||!0)}}),addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Mod-y":()=>this.editor.commands.redo(),"Shift-Mod-z":()=>this.editor.commands.redo()}},addProseMirrorPlugins(){let e=this.options.fragment?this.options.fragment:this.options.document.getXmlFragment(this.options.field);return[(0,o.YZ)(e),(0,s.$J)()]}})},23463:(e,t,n)=>{"use strict";n.d(t,{H:()=>i});var r=n(3583),s=n(13236),o=n(33718),a=n(64225);let i=s.YY.create({name:"filmstrip",onCreate(){let e=r.Mj.getState(this.editor.state).undoManager;e.on("stack-item-popped",t=>{let{undoStack:n,redoStack:r}=e,s=t.stackItem.meta.get("filmstripState");if(!s)return;let i=(0,o.Tz)((0,a.KA)().getState());"undo"===t.type&&r.length>0?r[r.length-1].meta.set("filmstripState",i):"redo"===t.type&&n.length>0&&n[n.length-1].meta.set("filmstripState",i),(0,a.KA)().dispatch((0,o.Uy)(s))})}})},35873:(e,t,n)=>{"use strict";n.d(t,{A:()=>i,q:()=>a});var r=n(13236),s=n(81570),o=n(82354);let a=r.YY.create({name:"scrollMargin",addProseMirrorPlugins:()=>[new s.k_({props:{scrollMargin:o.E0,scrollThreshold:o.E0}})]}),i=a},23552:(e,t,n)=>{"use strict";n.d(t,{R:()=>o});var r=n(13236),s=n(4468);let o=r.YY.create({name:"BlockHover",addProseMirrorPlugins(){return[(0,s.bA)(this.editor)]}})},85025:(e,t,n)=>{"use strict";n.d(t,{F:()=>o});var r=n(14041),s=n(69086);function o(e,t){let[n,o]=(0,r.useState)(()=>{try{let n=s.e.getItem(e);if(null===n)return t;return JSON.parse(n)}catch(e){return console.error("[useSessionStorage.getItem] Error getting sessionStorage item",e),t}});return[n,(0,r.useCallback)(t=>{try{s.e.setItem(e,JSON.stringify(t)),o(t)}catch(e){console.error("[useSessionStorage.setItem] Error setting sessionStorage item",e)}},[e])]}},37272:()=>{},41378:()=>{},11291:()=>{},52984:()=>{},68765:()=>{},57769:()=>{},83894:(e,t,n)=>{e.exports=n(41661)},85194:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>x,o5:()=>x});var r=n(13236);let s=e=>(0,r.Yp)({find:/--$/,replace:null!=e?e:"â€”"}),o=e=>(0,r.Yp)({find:/\.\.\.$/,replace:null!=e?e:"â€¦"}),a=e=>(0,r.Yp)({find:/(?:^|[\s{[(<'"\u2018\u201C])(")$/,replace:null!=e?e:"â€œ"}),i=e=>(0,r.Yp)({find:/"$/,replace:null!=e?e:"â€"}),l=e=>(0,r.Yp)({find:/(?:^|[\s{[(<'"\u2018\u201C])(')$/,replace:null!=e?e:"â€˜"}),d=e=>(0,r.Yp)({find:/'$/,replace:null!=e?e:"â€™"}),c=e=>(0,r.Yp)({find:/<-$/,replace:null!=e?e:"â†"}),u=e=>(0,r.Yp)({find:/->$/,replace:null!=e?e:"â†’"}),h=e=>(0,r.Yp)({find:/\(c\)$/,replace:null!=e?e:"\xa9"}),p=e=>(0,r.Yp)({find:/\(tm\)$/,replace:null!=e?e:"â„¢"}),f=e=>(0,r.Yp)({find:/\(sm\)$/,replace:null!=e?e:"â„ "}),m=e=>(0,r.Yp)({find:/\(r\)$/,replace:null!=e?e:"\xae"}),g=e=>(0,r.Yp)({find:/(?:^|\s)(1\/2)\s$/,replace:null!=e?e:"\xbd"}),w=e=>(0,r.Yp)({find:/\+\/-$/,replace:null!=e?e:"\xb1"}),y=e=>(0,r.Yp)({find:/!=$/,replace:null!=e?e:"â‰ "}),A=e=>(0,r.Yp)({find:/<<$/,replace:null!=e?e:"\xab"}),v=e=>(0,r.Yp)({find:/>>$/,replace:null!=e?e:"\xbb"}),b=e=>(0,r.Yp)({find:/\d+\s?([*x])\s?\d+$/,replace:null!=e?e:"\xd7"}),M=e=>(0,r.Yp)({find:/\^2$/,replace:null!=e?e:"\xb2"}),S=e=>(0,r.Yp)({find:/\^3$/,replace:null!=e?e:"\xb3"}),C=e=>(0,r.Yp)({find:/(?:^|\s)(1\/4)\s$/,replace:null!=e?e:"\xbc"}),k=e=>(0,r.Yp)({find:/(?:^|\s)(3\/4)\s$/,replace:null!=e?e:"\xbe"}),x=r.YY.create({name:"typography",addOptions:()=>({closeDoubleQuote:"â€",closeSingleQuote:"â€™",copyright:"\xa9",ellipsis:"â€¦",emDash:"â€”",laquo:"\xab",leftArrow:"â†",multiplication:"\xd7",notEqual:"â‰ ",oneHalf:"\xbd",oneQuarter:"\xbc",openDoubleQuote:"â€œ",openSingleQuote:"â€˜",plusMinus:"\xb1",raquo:"\xbb",registeredTrademark:"\xae",rightArrow:"â†’",servicemark:"â„ ",superscriptThree:"\xb3",superscriptTwo:"\xb2",threeQuarters:"\xbe",trademark:"â„¢"}),addInputRules(){let e=[];return!1!==this.options.emDash&&e.push(s(this.options.emDash)),!1!==this.options.ellipsis&&e.push(o(this.options.ellipsis)),!1!==this.options.openDoubleQuote&&e.push(a(this.options.openDoubleQuote)),!1!==this.options.closeDoubleQuote&&e.push(i(this.options.closeDoubleQuote)),!1!==this.options.openSingleQuote&&e.push(l(this.options.openSingleQuote)),!1!==this.options.closeSingleQuote&&e.push(d(this.options.closeSingleQuote)),!1!==this.options.leftArrow&&e.push(c(this.options.leftArrow)),!1!==this.options.rightArrow&&e.push(u(this.options.rightArrow)),!1!==this.options.copyright&&e.push(h(this.options.copyright)),!1!==this.options.trademark&&e.push(p(this.options.trademark)),!1!==this.options.servicemark&&e.push(f(this.options.servicemark)),!1!==this.options.registeredTrademark&&e.push(m(this.options.registeredTrademark)),!1!==this.options.oneHalf&&e.push(g(this.options.oneHalf)),!1!==this.options.plusMinus&&e.push(w(this.options.plusMinus)),!1!==this.options.notEqual&&e.push(y(this.options.notEqual)),!1!==this.options.laquo&&e.push(A(this.options.laquo)),!1!==this.options.raquo&&e.push(v(this.options.raquo)),!1!==this.options.multiplication&&e.push(b(this.options.multiplication)),!1!==this.options.superscriptTwo&&e.push(M(this.options.superscriptTwo)),!1!==this.options.superscriptThree&&e.push(S(this.options.superscriptThree)),!1!==this.options.oneQuarter&&e.push(C(this.options.oneQuarter)),!1!==this.options.threeQuarters&&e.push(k(this.options.threeQuarters)),e}})}}]);
//# sourceMappingURL=9605-449d2702d4da411d.js.map